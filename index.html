<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Wojny Świata – Strategia Turowa</title>
  <style>
    :root{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial}
    body{display:flex;flex-direction:column;align-items:center;gap:12px;padding:18px;background:#f3f3f3}
    h1{margin:0;font-size:22px}
    #boardCanvas{background:#dde0f6;box-shadow:0 6px 18px rgba(0,0,0,0.12);border-radius:6px}
    .controls{display:flex;gap:8px;align-items:center}
    button{padding:8px 12px;border-radius:6px;border:1px solid #bbb;background:white;cursor:pointer}
    .info{background:#fff;padding:8px 16px;border-radius:6px;border:1px solid #e0e0e0;max-width:720px}
    .legend{display:flex;gap:14px;align-items:center}
    .legend .box{width:20px;height:20px;border:1.5px solid #999;display:inline-block}
    label{display:flex;gap:6px;align-items:center}
    input[type=number]{width:70px}
    small{color:#444}
    .bank{font-weight:bold;margin-right:12px;}
    .win{color:#008f00;font-weight:bold;font-size:19px}
  </style>
</head>
<body>
  <h1>Wojny Świata – Strategia Turowa</h1>

  <div class="controls">
    <button id="newBtn">Nowa gra</button>
    <button id="endTurnBtn">Zakończ turę</button>
    <span class="bank" id="bankInfo">Monety: 2</span>
    <span id="gameMsg" class="win"></span>
  </div>

  <canvas id="boardCanvas" width="800" height="400"></canvas>

  <div class="info">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div>Aktualny gracz: <strong id="currentPlayer">1</strong></div>
        <div>Wybrana komórka: <span id="selectedCell">brak</span></div>
      </div>
      <div class="legend">
        <div><span class="box" style="background:#333"></span> Gracz 1</div>
        <div><span class="box" style="background:#c11"></span> Gracz 2</div>
        <div><span class="box" style="background:#bbb"></span> Ocean / nieaktywne</div>
      </div>
    </div>
    <hr>
    <div>
      <strong>Zasady:</strong>
      <ul>
        <li>Każdy gracz zaczyna z bazą (Ameryka Płd. i Australia) – nie można jej zniszczyć, ale można przejąć.</li>
        <li>Każda tura: +2 monety do portfela. Żołnierz kosztuje 1 monetę (kliknij na własną bazę lub pole, by rekrutować, jeśli masz monety).</li>
        <li>Atak: Kliknij własne pole, potem sąsiadujące pole wroga lub neutralne (jeśli masz żołnierzy).</li>
        <li>Atakujesz jeśli masz więcej żołnierzy niż obrona – przejmujesz pole. W przeciwnym razie żołnierze giną.</li>
        <li>Wygrywasz, gdy przejmiesz bazę przeciwnika lub większość świata!</li>
      </ul>
      <small>Uproszczona mapa świata, oceanów nie można atakować ani zajmować.<br>
      Przykład dla 2 graczy, ale możesz zmienić kod na więcej.</small>
    </div>
  </div>

<script>
const canvas = document.getElementById('boardCanvas');
const ctx = canvas.getContext('2d');
const newBtn = document.getElementById('newBtn');
const endTurnBtn = document.getElementById('endTurnBtn');
const currentPlayerEl = document.getElementById('currentPlayer');
const selectedCellEl = document.getElementById('selectedCell');
const bankInfo = document.getElementById('bankInfo');
const msgEl = document.getElementById('gameMsg');

const WIDTH = 40, HEIGHT = 20; // plansza 40x20
const CELL = Math.floor(canvas.width / WIDTH);

let grid = []; // każda komórka: {land:0/1, owner:0/1/2, troops:int, base:false/true}
let currentPlayer = 1;
let coins = [0, 2, 2]; // coins[1] dla gracza 1, coins[2] dla gracza 2
let selected = null; // [x,y]
let basePos = [[-1,-1],[5,5],[34,15]]; // [niedziałający],[G1:Am.Płd],[G2:Australia]
let winner = 0;

// uproszczona maska świata: 1 = ląd, 0 = ocean [40 szer x 20 wys]
const worldMask = [
"0000000000000000000000000000000000000000",
"0000000011111100000000000001111111000000",
"0000001111111111000000011111111111100000",
"0000011111111111100001111111111111110000",
"0000111111111111110011111111111111111000",
"0001111111111111111111111111111111111100",
"0001111111001111111111111111111111111100",
"0011111110000111111111111111111111111110",
"0111111000000111111111111111111111111111",
"0111100000001111111111111111111111111111",
"0111000000011111111111111111111111111111",
"0111000001111111111111111111111111111111",
"0111100011111111111111111111111111111100",
"0111111111111111111111111111111111100000",
"0011111111111111111111111111111100000000",
"0001111111111111111111111111110000000000",
"0000111111111111111111111111000000000000",
"0000011111111111111111111100000000000000",
"0000001111111111111111110000000000000000",
"0000000111111111111110000000000000000000"
];

function createMap(){
  let map = [];
  for(let y=0; y<HEIGHT; y++){
    let row = [];
    for(let x=0; x<WIDTH; x++){
      row.push(worldMask[y][x]==="1"?1:0);
    }
    map.push(row);
  }
  return map;
}

// reset gry
function newGame(){
  grid=[];
  let map=createMap();
  for(let y=0;y<HEIGHT;y++){
    let row=[];
    for(let x=0;x<WIDTH;x++){
      row.push({
        land: map[y][x],
        owner: 0,
        troops: 0,
        base: false
      });
    }
    grid.push(row);
  }
  // ustaw bazy (tylko na lądach!)
  grid[basePos[1][1]][basePos[1][0]].owner=1;
  grid[basePos[1][1]][basePos[1][0]].base=true;
  grid[basePos[2][1]][basePos[2][0]].owner=2;
  grid[basePos[2][1]][basePos[2][0]].base=true;
  // Każdy zaczyna z 0 żołnierzy na bazie
  grid[basePos[1][1]][basePos[1][0]].troops=0;
  grid[basePos[2][1]][basePos[2][0]].troops=0;
  currentPlayer=1; coins=[0,2,2];
  selected=null; winner=0;
  draw();
  msgEl.textContent="";
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let y=0;y<HEIGHT;y++){
    for(let x=0;x<WIDTH;x++){
      let cell=grid[y][x], xp=x*CELL, yp=y*CELL;
      // ocean
      if(!cell.land){
        ctx.fillStyle='#bbb';
        ctx.fillRect(xp,yp,CELL,CELL);
      }
      // ląd
      else{
        // pole neutralne
        if(cell.owner===0) ctx.fillStyle='#f4f4f4';
        // gracz 1
        else if(cell.owner===1) ctx.fillStyle='#333';
        // gracz 2
        else ctx.fillStyle='#c11';
        ctx.fillRect(xp,yp,CELL,CELL);

        // zaznaczanie aktywne
        if(selected && selected[0]===x && selected[1]===y){
          ctx.strokeStyle='#08f'; ctx.lineWidth=3;
          ctx.strokeRect(xp+2,yp+2,CELL-4,CELL-4);
          ctx.lineWidth=1;
        }

        // BAZA
        if(cell.base){
          ctx.beginPath();
          ctx.arc(xp+CELL/2, yp+CELL/2, CELL*0.38, 0, 2*Math.PI);
          ctx.strokeStyle='#09f';
          ctx.lineWidth=2.6;
          ctx.stroke();
          ctx.lineWidth=1;
          ctx.fillStyle="#09f";
          ctx.font = (CELL*0.63)+'px sans-serif';
          ctx.textAlign='center';
          ctx.textBaseline='middle';
          ctx.fillText('B', xp+CELL/2, yp+CELL/2);
        }

        // liczba żołnierzy
        if(cell.troops>0){
          ctx.fillStyle=(cell.owner===1?'#fff':'#fff');
          ctx.font = (CELL*0.54)+'px sans-serif';
          ctx.textAlign='right'; ctx.textBaseline='bottom';
          ctx.fillText(cell.troops, xp+CELL-6, yp+CELL-4);
        }
      }
      // siatka
      ctx.strokeStyle='#a9a9a9'; ctx.strokeRect(xp+0.5,yp+0.5,CELL-1,CELL-1);
    }
  }
  currentPlayerEl.textContent=currentPlayer;
  selectedCellEl.textContent=selected?selected.join(','):'brak';
  bankInfo.textContent="Monety: "+coins[currentPlayer];
}

function inBounds(x,y){return x>=0&&y>=0&&x<WIDTH&&y<HEIGHT}
function isNeighbor(x1,y1,x2,y2){
  return (Math.abs(x1-x2)+Math.abs(y1-y2))===1;
}

canvas.addEventListener('click', e=>{
  if(winner) return;
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left, my=e.clientY-rect.top;
  const x=Math.floor(mx/CELL), y=Math.floor(my/CELL);
  if(!inBounds(x,y))return;
  const cell=grid[y][x];
  // ocean
  if(!cell.land) return;
  // kliknij własne pole -> rekrutacja jeśli masz monetę
  if(cell.owner===currentPlayer){
    // kliknij już zaznaczone pole = rekrutuj
    if(selected && selected[0]===x && selected[1]===y){
      if(coins[currentPlayer]>0){
        cell.troops++;
        coins[currentPlayer]--;
      }else{
        msgEl.textContent="Za mało monet!";
        setTimeout(()=>msgEl.textContent="",1000);
      }
      draw();
      return;
    }
    // wybierz pole do ataku
    selected=[x,y];
    draw();
    return;
  }
  // atak
  if(selected){
    const [sx,sy]=selected;
    const from=grid[sy][sx], to=cell;
    // musi być sąsiad
    if(!isNeighbor(sx,sy,x,y)){selected=null;draw();return;}
    // nie można atakować oceanu
    if(!to.land){selected=null;draw();return;}
    // musisz mieć żołnierzy
    if(from.troops<1){selected=null;draw();return;}
    // atak — jeśli masz więcej żołnierzy niż obrona
    if(from.troops>to.troops){
      let left=from.troops-to.troops;
      // przejmij pole
      to.owner=currentPlayer;
      to.troops=left;
      // baza wroga przejęta? KONIEC
      if(to.base && to.owner===currentPlayer){
        winner=currentPlayer;
        msgEl.textContent="Gracz "+currentPlayer+" przejął bazę wroga! WYGRYWA!";
      }
      from.troops=0;
    }else{
      // atak nieudany, tracisz żołnierzy
      to.troops=Math.max(0,to.troops-from.troops);
      from.troops=0;
    }
    selected=null; draw();
    // sprawdź czy wygrał przez przewagę terytorium
    setTimeout(checkWin,100);
    return;
  }
});

function endTurn(){
  if(winner) return;
  currentPlayer = currentPlayer===1?2:1;
  coins[currentPlayer]+=2; // +2 monety na turę
  draw();
  msgEl.textContent="";
}
endTurnBtn.onclick=endTurn;
newBtn.onclick=newGame;

function checkWin(){
  // wygrywa gracz który przejął bazę wroga (już obsłużone) albo kontroluje > połowę lądów
  let cnt=[0,0,0], land=0;
  for(let y=0;y<HEIGHT;y++)for(let x=0;x<WIDTH;x++)
    if(grid[y][x].land){land++; if(grid[y][x].owner)cnt[grid[y][x].owner]++;}
  if(cnt[1]>land/2){
    winner=1;msgEl.textContent="Gracz 1 kontroluje świat! WYGRYWA!";
  }
  if(cnt[2]>land/2){
    winner=2;msgEl.textContent="Gracz 2 kontroluje świat! WYGRYWA!";
  }
}

newGame();

window.addEventListener('keydown',(e)=>{
  if(e.key==='n') newGame();
  if(e.key===' '){ e.preventDefault(); endTurn();}
});
</script>
</body>
</html>
